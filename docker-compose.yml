# ============================================================================
# NesVentory Docker Compose Configuration
# ============================================================================
# This docker-compose.yml provides an example configuration for running
# NesVentory as a self-hosted home inventory management application.
#
# Version: 6.0 (SQLite-based unified container)
# Documentation: https://github.com/tokendad/NesVentory
# ============================================================================
services:
  nesventory-local:
    build: .
    container_name: nesventory5
    restart: unless-stopped
    # Network mode host is required for Bluetooth access
    network_mode: host
    # Privileged mode is often required for hardware access
    privileged: true
    environment:
      # IMPORTANT: Generate secure, random keys for these values before deploying!
      SECRET_KEY: CHANGE_ME_GENERATE_SECURE_KEY_HERE
      JWT_SECRET_KEY: CHANGE_ME_GENERATE_SECURE_KEY_HERE
      PUID: 1000
      PGID: 1000
      UMASK: 002
      TZ: Etc/UTC
      APP_PORT: 8181
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
      JWT_ALGORITHM: HS256
      # GEMINI_API_KEY: your-gemini-api-key-here
      # GEMINI_MODEL: gemini-2.0-flash-exp
      # Available models:
      #   - gemini-2.0-flash-exp (recommended, latest experimental)
      #   - gemini-1.5-flash (fast and efficient)
      #   - gemini-1.5-flash-8b (smaller, faster)
      #   - gemini-1.5-pro (best for complex tasks)
      #   - gemini-exp-1206 (cutting-edge experimental)
      # GEMINI_REQUEST_DELAY: 4.0
      # GOOGLE_CLIENT_ID: your-google-client-id
      # GOOGLE_CLIENT_SECRET: your-google-client-secret
      DISABLE_SIGNUPS: true
    volumes:
      - /data/DockerConfigs/nesventory5-data:/app/data
      - ./backend/app:/app/app
      - /etc/localtime:/etc/localtime:ro
      - /dev:/dev
      # DBus access for Bluetooth
      - /var/run/dbus:/var/run/dbus
      - /run/dbus:/run/dbus

    healthcheck:
      # Use CMD-SHELL so the container's APP_PORT environment variable is used.
      # This assumes the container has curl available; if not, switch to python3 or
      # install curl in the image.
      test: ["CMD-SHELL", "curl -fsS http://localhost:8181/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
